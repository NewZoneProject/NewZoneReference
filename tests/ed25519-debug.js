// Ed25519 debug test for node:crypto-backed implementation
// Run: node tests/ed25519-debug.js

import {
  ed25519GetPublicKey,
  ed25519Sign,
  ed25519Verify
} from '../lib/ed25519/ed25519.js';

function hex(u8) {
  return Array.from(u8).map(x => x.toString(16).padStart(2, '0')).join('');
}

function assert(cond, msg) {
  if (!cond) throw new Error("FAIL: " + msg);
}

console.log("\n=== Ed25519 Debug Test (node:crypto version) ===\n");

// ------------------------------------------------------------
// RFC 8032 Test Vector 1
// ------------------------------------------------------------

const seed = new Uint8Array([
  0x9d,0x61,0xb1,0x9d,0xef,0xfd,0x5a,0x60,
  0xba,0x84,0x4a,0xf4,0x92,0xec,0x2c,0xc4,
  0x44,0x49,0xc5,0x69,0x7b,0x32,0x69,0x19,
  0x70,0x3b,0xac,0x03,0x1c,0xae,0x7f,0x60
]);

const msg = new Uint8Array([]);

const sig_rfc = new Uint8Array([
  0xe5,0x56,0x43,0x00,0xc3,0x60,0xac,0x72,
  0x90,0x86,0xe2,0xcc,0x80,0x6e,0x82,0x8a,
  0x84,0x87,0x7f,0x1e,0xb8,0xe5,0xd9,0x74,
  0xd8,0x73,0xe0,0x65,0x22,0x49,0x01,0x55,
  0x5f,0xb8,0x82,0x15,0x90,0xa3,0x3b,0xac,
  0xc6,0x1e,0x39,0x70,0x1c,0xf9,0xb4,0x6b,
  0xd2,0x5b,0xf5,0xf0,0x59,0x5b,0xbe,0x24,
  0x65,0x51,0x41,0x43,0x8e,0x7a,0x10,0x0b
]);

console.log("→ Generating our public key...");
const pub = ed25519GetPublicKey(seed);
console.log("Public key:", hex(pub));

console.log("\n→ Generating our signature...");
const sig = ed25519Sign(msg, seed);

console.log("\n--- R/S comparison ---");
console.log("R (ours):", hex(sig.slice(0, 32)));
console.log("R (RFC): ", hex(sig_rfc.slice(0, 32)));
console.log("S (ours):", hex(sig.slice(32)));
console.log("S (RFC): ", hex(sig_rfc.slice(32)));

console.log("\n--- Verify check ---");
console.log("verify(ours):", ed25519Verify(msg, sig, pub));
console.log("verify(RFC): ", ed25519Verify(msg, sig_rfc, pub));

console.log("\n=== END ===\n");